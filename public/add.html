<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Szavak hozzáadása</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/tools2.js"></script>
    <script>
        $(function () {
            $("#includedContent").load("partials/head.html");
        });
    </script>
    <div id="includedContent"></div>

</head>

<body>
    <div class="main">
        <div class="mb-3">
            <label for="wordOrig" class="form-label">Eredeti szó:</label>
            <input type="text" class="form-control" id="wordOrig">
        </div>
        <div class="mb-3">
            <label for="wordOrig" class="form-label">Lefordítva:</label>
            <input type="text" class="form-control" id="wordMeaning">
        </div>
        <div class="mb-3">
            <h5 class="form-label font-weight-bold text-danger text-center d-none" id="exists">Ez a szó
                már létezik!
            </h5>
            <h5 class="form-label font-weight-bold text-success text-center d-none" id="success">Szó hozzáadva!
            </h5>
        </div>
        <div class="mb-3">
            <span class="btn btn-primary form-control" id="add">Hozzáadás</span>
            <span class="btn btn-danger form-control d-none" id="addForce">Hozzáadás Mégis</span>
        </div>
        <div class="mb-3">
            <span class="btn btn-secondary form-control" id="redirect">Több hozzáadása (fájlból)</span>
        </div>
        <div class="mb-3">
            <span class="btn btn-danger form-control" id="back">Vissza</span>
        </div>
    </div>
    <script defer>
        $(() => {
            var currentUrl = new URL(document.URL);
            var requestUrl = `/api/v1`;

            var _wordOrig = document.querySelector("#wordOrig");
            var _wordMeaning = document.querySelector("#wordMeaning");
            var _add = document.querySelector("#add");
            var _addForce = document.querySelector("#addForce");
            var _exists = document.querySelector("#exists");
            var _success = document.querySelector("#success");
            var _redirect = document.querySelector("#redirect");
            var _back = document.querySelector("#back");
            _back.onclick = () => {
                location.replace("/")
            }

            _redirect.addEventListener("click", (ev) => {
                location.replace("/addMultiple.html")
            })

            function add(force) {
                //_wordOrig.style.backgroundColor = "#00000000"
                //_wordMeaning.style.backgroundColor = "#00000000"
                _wordMeaning.classList.remove("is-invalid");
                _wordOrig.classList.remove("is-invalid");
                _add.classList.remove("d-none");
                _exists.classList.add("d-none");
                _addForce.classList.add("d-none");
                _success.classList.add("d-none");

                if (!_wordOrig.value || !_wordMeaning.value) {
                    return alert("nincs megadva valamelyik mező!");
                }
                var resp = httpJsonPost(`${requestUrl}/newWord`, {
                    newWord: _wordOrig.value,
                    lang: "hu",
                    meaning: _wordMeaning.value,
                    meaningLang: "fi",
                    ignoreWarning: force
                });

                console.log(resp);

                if (resp.error) {
                    if (resp.code) {
                        if (resp.code == 409) {
                            //alert("létező szó");
                            _add.classList.add("d-none");
                            _addForce.classList.remove("d-none")
                            _exists.classList.remove("d-none")
                            switch (resp.firstlast) {
                                case 0:
                                    _wordOrig.classList.add("is-invalid");
                                    //_wordOrig.style.backgroundColor = "#be202050"
                                    break;
                                case 1:
                                    _wordMeaning.classList.add("is-invalid");
                                    //_wordMeaning.style.backgroundColor = "#be202050"
                                    break;
                                case 2:
                                    //_wordMeaning.style.backgroundColor = "#be202050"
                                    //_wordOrig.style.backgroundColor = "#be202050";
                                    _wordMeaning.classList.add("is-invalid");
                                    _wordOrig.classList.add("is-invalid");
                                    break;
                            }
                        }
                    } else {
                        console.log("unknown err");
                        alert("Ismeretlen hiba!");
                    }
                } else {
                    _wordMeaning.value = "";
                    _wordOrig.value = "";
                    _success.classList.remove("d-none");
                    setTimeout(() => {
                        _success.classList.add("d-none");
                    }, 1000)
                }
            }
            _add.addEventListener("click", _ => add(false));
            _addForce.addEventListener("click", _ => add(true));
            _wordOrig.onchange = () => {
                var translation = httpJsonGet(`${requestUrl}/translate?text=${_wordOrig.value}`);
                if (translation.error) {
                    console.log(translation);
                    return
                };
                _wordMeaning.value = translation.text.toLowerCase();
            }
        })
    </script>
</body>

</html>